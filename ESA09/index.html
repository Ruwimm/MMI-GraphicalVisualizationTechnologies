<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ESA 9 - Torustextur</title>
    <link rel="stylesheet" href="style.css">

    <script src="gl-matrix.js"></script>
    <script src="GVT_Src_vertexData_plane.js"></script>
    <script src="GVT_Src_vertexData_sphere.js"></script>
    <script src="GVT_Src_vertexData_sphere.js"></script>
    <script src="GVT_Src_vertexData_torus.js"></script>
    <script src="TXR_Src_tpl.js"></script>
    <script type="x-shader/x-vertex" id="vertexshader">
        attribute vec3 aPosition;
        attribute vec3 aNormal;
        attribute vec2 aTextureCoord;

        uniform mat4 uPMatrix;
        uniform mat4 uMVMatrix;
        uniform mat3 uNMatrix;
        uniform vec4 uColor;

        varying vec3 vNormal;
        varying vec4 vPosition;
        varying vec4 vBaseColor;
        varying vec2 vTextureCoord;



        void main(){
            vec4 tPosition = uMVMatrix * vec4(aPosition, 1.0);
            gl_Position = uPMatrix * tPosition;

            vNormal = normalize(uNMatrix * aNormal);
            vPosition = tPosition;
            vBaseColor = uColor;
            vTextureCoord = aTextureCoord;
        }
    </script>
    <script type="x-shader/x-fragment" id="fragmentshader">
        precision mediump float;

        varying vec3 vNormal;
        varying vec4 vPosition;
        varying vec4 vBaseColor;
        varying vec2 vTextureCoord;

        uniform sampler2D uTexture;
        //uniform bool uUseTexture;

        // Material
        struct PhongMaterial {
            vec3 ka;
            vec3 kd;
            vec3 ks;
            float ke;
        };
        uniform PhongMaterial material;

        // Ambient light
        uniform vec3 ambientLight;

        // Punktlichter
        const int MAX_LIGHT_SOURCES = 8;
        struct LightSource {
            bool isOn;
            vec3 position;
            vec3 color;
        };
        uniform LightSource light[MAX_LIGHT_SOURCES];

        vec3 phongSingle(vec3 p, vec3 n, vec3 v, LightSource l) {
            vec3 L = l.color;
            vec3 s = normalize(l.position - p);
            vec3 r = reflect(-s, n);
            float sn = max(dot(s,n), 0.0);
            float rv = max(dot(r,v), 0.0);
            vec3 diffuse  = material.kd * L * sn;
            vec3 specular = material.ks * L * pow(rv, material.ke);
            return diffuse + specular;
        }

        vec3 phong(vec3 p, vec3 n, vec3 v) {
            vec3 result = material.ka * ambientLight;
            for (int j=0; j<MAX_LIGHT_SOURCES; j++) {
                if (light[j].isOn) {
                    result += phongSingle(p, n, v, light[j]);
                }
            }
            return result;
        }

        void main() {
            vec3 V = normalize(-vPosition.xyz);
            vec3 N = normalize(vNormal);

            vec3 AD   = material.ka * ambientLight; // Ambient
            vec3 diff = vec3(0.0);
            vec3 spec = vec3(0.0);

            for (int j = 0; j < MAX_LIGHT_SOURCES; ++j) {
                if (light[j].isOn) {
                    vec3 Lc = light[j].color;
                    vec3 S  = normalize(light[j].position - vPosition.xyz);
                    float sn = max(dot(S, N), 0.0);
                    diff += material.kd * Lc * sn;

                    vec3 R  = reflect(-S, N);
                    float rv = max(dot(R, V), 0.0);
                    spec += material.ks * Lc * pow(rv, material.ke);
                }
            }

            vec4 tex = texture2D(uTexture, vTextureCoord);
            vec3 rgb = tex.rgb * (AD + diff) + spec;
            gl_FragColor = vec4(rgb, tex.a);
        }
    </script>

</head>
<body onload="app.start()">

<h1 id="title">ESA 9 - Torustextur</h1>
<canvas id="canvas" width="500" height="500"></canvas>


<div id="hinweise">
    <h2>Allgemeine Hinweise</h2>
    <ul>
        <li>
            <b>Steuerung:</b>
            WASD: Links/Rechts und Oben/Unten <br>

            Pfeiltasten: Drehen (4 Richtungen)

        </li>
        <li>
            <b>Darstellung:</b>
            Zwei Torus, zwei Kugeln, Boden mit displacement
        </li>
        <li>
            <b>Quelle:</b>
            Kursmaterialien
        </li>
    </ul>
</div>
<div id="Buttons">
    <button id="overviewButton" onclick="window.location.href='../index.html'">Zur Gesamtuebersicht</button>

</div>
</body>
</html>